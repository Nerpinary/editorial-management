# Система управления нагрузкой редакций

Веб-приложение для визуального распределения сотрудников по редакциям с целью равномерного распределения нагрузки.

## Возможности

- **Управление редакциями**: создание, редактирование, удаление редакций с указанием количества статей в месяц
- **Управление сотрудниками**: создание, редактирование сотрудников с категориями (Junior, Middle, Senior) и емкостью
- **Визуальное распределение**: назначение сотрудников на редакции с указанием процента нагрузки
- **Автоподсчеты**: автоматический расчет покрытия нагрузки по редакциям и общей нагрузки сотрудников
- **Аналитика**: детальный анализ распределения с рекомендациями по оптимизации

## Технологии

### Frontend
- Vue.js 3
- Vue Router
- Pinia (управление состоянием)
- Tailwind CSS
- Heroicons

### Backend
- Node.js
- Express.js
- SQLite (база данных)

## Установка и запуск

### Быстрый старт с Makefile

```bash
# Показать все доступные команды
make help

# Первый запуск (проверка + установка + запуск)
make first-run

# Или пошагово:
make install    # Установить все зависимости
make dev        # Запустить в режиме разработки
```

### Основные команды

```bash
# Установка и запуск
make install          # Установить все зависимости
make dev             # Запуск в режиме разработки (сервер + клиент)
make run.dev         # Алиас для dev

# Отдельные сервисы
make server          # Запустить только backend (порт 3001)
make client          # Запустить только frontend (порт 3000)

# Продакшен
make build           # Собрать проект
make start           # Запустить продакшен версию

# Управление
make clean           # Очистить node_modules и базу данных
make reset           # Полная переустановка
make stop            # Остановить все процессы
make status          # Показать статус процессов
```

### Альтернативный запуск через npm

```bash
# Установка зависимостей
npm run install-all

# Запуск в режиме разработки
npm run dev

# Или по отдельности
npm run server       # Backend (порт 3001)
npm run client       # Frontend (порт 3000)
```

### Сборка для продакшена

```bash
make build && make start
# или
npm run build && npm start
```

## Структура проекта

```
management/
├── server/                 # Backend API
│   ├── index.js           # Основной сервер
│   ├── package.json       # Зависимости сервера
│   └── database.sqlite    # База данных (создается автоматически)
├── client/                # Frontend приложение
│   ├── src/
│   │   ├── views/         # Страницы приложения
│   │   ├── stores/        # Pinia stores
│   │   ├── router/        # Vue Router
│   │   └── main.js        # Точка входа
│   ├── package.json       # Зависимости клиента
│   └── vite.config.js     # Конфигурация Vite
├── package.json           # Корневые скрипты
└── README.md             # Документация
```

## API Endpoints

### Редакции
- `GET /api/departments` - получить все редакции
- `POST /api/departments` - создать редакцию
- `PUT /api/departments/:id` - обновить редакцию
- `DELETE /api/departments/:id` - удалить редакцию

### Сотрудники
- `GET /api/employees` - получить всех сотрудников
- `POST /api/employees` - создать сотрудника
- `PUT /api/employees/:id` - обновить сотрудника
- `DELETE /api/employees/:id` - удалить сотрудника

### Назначения
- `GET /api/assignments` - получить все назначения
- `POST /api/assignments` - создать назначение
- `DELETE /api/assignments/:id` - удалить назначение

### Аналитика
- `GET /api/analytics` - получить аналитику по покрытию

### Валидация
- `GET /api/validation/:departmentId` - проверить валидность назначений по грейдам

## Грейды сотрудников

### СМВ - Старший менеджер выпуска
- **Емкость**: 0.8 (ниже базовой)
- **Функции**: Может самостоятельно выпускать статьи и проверять работу младших
- **Особенность**: Обязателен для проверки ММВ, тратит время на контроль

### МВ - Менеджер выпуска  
- **Емкость**: 1.0 (базовая единица)
- **Функции**: Может самостоятельно выпускать статьи
- **Особенность**: Работает независимо, стандартная продуктивность

### ММВ - Младший менеджер выпуска
- **Емкость**: 1.3 (повышенная)
- **Функции**: Может верстать статьи, но требует проверки
- **Особенность**: Обязательно требует назначения СМВ для проверки, фокусируется только на верстке

## Использование

### Первый запуск

```bash
# Клонируйте репозиторий и перейдите в папку
cd management

# Быстрый старт (проверка + установка + запуск)
make first-run
```

### Ежедневная работа

```bash
# Запуск в режиме разработки
make dev

# Остановка всех процессов
make stop

# Проверка статуса
make status

# Очистка при проблемах
make clean && make install
```

### Работа с проектом

1. **Создание редакций**: добавьте редакции с указанием количества статей в месяц
2. **Добавление сотрудников**: создайте сотрудников с указанием категории и емкости
3. **Распределение**: назначьте сотрудников на редакции с указанием процента нагрузки
4. **Мониторинг**: используйте аналитику для контроля покрытия и оптимизации

## Автоподсчеты

- **Покрытие редакции** = (Сумма нагрузок сотрудников * их емкость) / Количество статей в месяц * 100%
- **Общая нагрузка сотрудника** = Сумма всех назначенных процентов нагрузки
- **Статусы**: Покрыто (≥100%), Частично (80-99%), Недопокрыто (<80%)

## Валидация и рекомендации

### Автоматическая валидация грейдов:
- **Ошибка**: ММВ без СМВ для проверки
- **Предупреждение**: Слишком много ММВ на одного СМВ (рекомендуется 1 СМВ на 1-2 ММВ)

### Рекомендации по нагрузке:
- Недопокрытые редакции (покрытие < 80%)
- Перегруженные сотрудники (нагрузка > емкости)
- Недогруженные сотрудники (нагрузка < 80% от емкости)

### Логика грейдов:
- **ММВ** (1.5 емкость) - высокая продуктивность, но требует проверки
- **МВ** (1.2 емкость) - работают независимо
- **СМВ** (1.0 емкость) - контролируют качество, проверяют ММВ

## Резервное копирование

### Создание резервной копии
```bash
# Автоматический бэкап с временной меткой
make backup

# Бэкап с пользовательским именем
make backup-custom NAME=my_backup_name
```

### Восстановление из резервной копии
```bash
# Остановите сервер
make stop

# Восстановите базу данных
cp backups/database_backup_YYYYMMDD_HHMMSS.sqlite server/database.sqlite

# Или из SQL дампа
sqlite3 server/database.sqlite < backups/database_dump_YYYYMMDD_HHMMSS.sql

# Запустите сервер
make dev
```

## Troubleshooting

### Проблемы с запуском

```bash
# Проверить установленные зависимости
make check-deps

# Полная переустановка
make reset

# Проверить занятые порты
make status

# Остановить все процессы
make stop
```

### Частые проблемы

1. **Порты заняты**: `make stop` или `make status` для проверки
2. **Ошибки зависимостей**: `make clean && make install`
3. **База данных повреждена**: `make clean` (удалит database.sqlite)
4. **Node.js не найден**: установите Node.js версии 16+

### Логи и отладка

```bash
# Запуск только сервера для отладки
make server

# Запуск только клиента
make client

# Проверка процессов
make status
```
